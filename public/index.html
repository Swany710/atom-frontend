
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Construction Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #000000;
        color: #ffffff;
        overflow: hidden;
    }

    .app {
        height: 100vh;
        display: flex;
        flex-direction: column;
    }

    /* Header */
    .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 2rem;
        gap: 1rem;
    }

    .header-left {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .back-button {
        font-size: 2rem;
        color: #ff6b35;
        cursor: pointer;
        transition: opacity 0.2s;
    }

    .back-button:hover {
        opacity: 0.7;
    }

    .title {
        font-size: 3rem;
        font-weight: 300;
        color: #ff6b35;
        letter-spacing: 2px;
    }

    /* Header Right - Profile Dropdown */
    .header-right {
        position: relative;
    }

    .profile-dropdown {
        position: relative;
    }

    .profile-button {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 2px solid #ff6b35;
        background: rgba(255, 107, 53, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 1.2rem;
        color: #ff6b35;
    }

    .profile-button:hover {
        background: rgba(255, 107, 53, 0.2);
        transform: scale(1.05);
    }

    .dropdown-menu {
        position: absolute;
        top: 60px;
        right: 0;
        width: 250px;
        background: rgba(10, 10, 10, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 107, 53, 0.3);
        border-radius: 12px;
        padding: 1rem;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s ease;
        z-index: 1000;
    }

    .dropdown-menu.visible {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    .dropdown-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.75rem;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.2s;
        color: #ccc;
        margin-bottom: 0.5rem;
    }

    .dropdown-item:hover {
        background: rgba(255, 107, 53, 0.1);
        color: #ff6b35;
    }

    .dropdown-item:last-child {
        margin-bottom: 0;
    }

    /* Main Content */
    .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        position: relative;
    }

    /* Voice Interface */
    .voice-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 3rem;
        width: 100%;
        max-width: 800px;
    }

    .waveform-container {
        width: 100%;
        height: 300px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }

    /* Smooth SVG Waveform */
    .waveform-svg {
        width: 100%;
        height: 100%;
    }

    .waveform-path {
        fill: none;
        stroke: url(#waveGradient);
        stroke-width: 3;
        filter: url(#glow);
    }

    .waveform-fill {
        fill: url(#waveGradientFill);
        opacity: 0.3;
    }

    /* Control Buttons */
    .controls {
        display: flex;
        gap: 2rem;
        align-items: center;
    }

    .voice-button {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        border: 3px solid #ff6b35;
        background: rgba(255, 107, 53, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 2rem;
        color: #ff6b35;
    }

    .voice-button:hover {
        background: rgba(255, 107, 53, 0.2);
        transform: scale(1.05);
    }

    .voice-button.recording {
        background: #ff6b35;
        color: #000000;
        animation: recordPulse 1s ease-in-out infinite;
    }

    @keyframes recordPulse {
        0%, 100% { box-shadow: 0 0 0 0 rgba(255, 107, 53, 0.7); }
        50% { box-shadow: 0 0 0 20px rgba(255, 107, 53, 0); }
    }

    .secondary-button {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        border: 2px solid #666;
        background: rgba(255, 255, 255, 0.05);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 1.5rem;
        color: #999;
    }

    .secondary-button:hover {
        border-color: #ff6b35;
        color: #ff6b35;
    }

    /* Status Text */
    .status-text {
        font-size: 1.2rem;
        color: #999;
        text-align: center;
        min-height: 2rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .status-text.listening {
        color: #ff6b35;
    }

    /* Response Area */
    .response-area {
        position: absolute;
        bottom: 2rem;
        left: 2rem;
        right: 2rem;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 107, 53, 0.3);
        border-radius: 12px;
        padding: 1.5rem;
        backdrop-filter: blur(10px);
        transform: translateY(100%);
        transition: transform 0.3s ease;
    }

    .response-area.visible {
        transform: translateY(0);
    }

    .response-title {
        color: #ff6b35;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .response-content {
        color: #ccc;
        line-height: 1.5;
    }

    /* Navigation Menu */
    .nav-menu {
        position: fixed;
        top: 0;
        left: -300px;
        width: 300px;
        height: 100vh;
        background: rgba(0, 0, 0, 0.95);
        backdrop-filter: blur(20px);
        border-right: 1px solid rgba(255, 107, 53, 0.3);
        transition: left 0.3s ease;
        z-index: 1000;
        padding: 2rem;
    }

    .nav-menu.open {
        left: 0;
    }

    .nav-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        border-bottom: 1px solid rgba(255, 107, 53, 0.3);
        padding-bottom: 1rem;
    }

    .nav-title {
        color: #ff6b35;
        font-size: 1.5rem;
        font-weight: 600;
    }

    .close-nav {
        color: #ff6b35;
        font-size: 1.5rem;
        cursor: pointer;
    }

    .nav-items {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .nav-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.2s;
        color: #ccc;
    }

    .nav-item:hover {
        background: rgba(255, 107, 53, 0.1);
        color: #ff6b35;
    }

    .nav-item.active {
        background: rgba(255, 107, 53, 0.2);
        color: #ff6b35;
    }

    /* Overlay */
    .overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        z-index: 999;
    }

    .overlay.visible {
        opacity: 1;
        visibility: visible;
    }

    /* Loading Spinner */
    .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 107, 53, 0.3);
        border-radius: 50%;
        border-top-color: #ff6b35;
        animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 768px) {
        .title {
            font-size: 2rem;
        }
        
        .voice-button {
            width: 70px;
            height: 70px;
            font-size: 1.8rem;
        }
        
        .secondary-button {
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
        }
        
        .nav-menu {
            width: 280px;
        }
    }
</style>
</head>
<body>
    <div class="app">
        <!-- Navigation Menu -->
        <div class="nav-menu" id="navMenu">
            <div class="nav-header">
                <div class="nav-title">Menu</div>
                <div class="close-nav" onclick="toggleMenu()">√ó</div>
            </div>
            <div class="nav-items">
                <div class="nav-item active" onclick="showVoiceInterface()">
                    <span>üé§</span>
                    <span>Voice Assistant</span>
                </div>
                <div class="nav-item" onclick="showDashboard()">
                    <span>üìä</span>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item" onclick="showTasks()">
                    <span>‚úì</span>
                    <span>Tasks</span>
                </div>
                <div class="nav-item" onclick="showContacts()">
                    <span>üë•</span>
                    <span>Contacts</span>
                </div>
                <div class="nav-item" onclick="showCalendar()">
                    <span>üìÖ</span>
                    <span>Calendar</span>
                </div>
                <div class="nav-item" onclick="showEmail()">
                    <span>‚úâÔ∏è</span>
                    <span>Email</span>
                </div>
                <div class="nav-item" onclick="showPhotos()">
                    <span>üì∏</span>
                    <span>Photos</span>
                </div>
                <div class="nav-item" onclick="showSettings()">
                    <span>‚öôÔ∏è</span>
                    <span>Settings</span>
                </div>
            </div>
        </div>
    <!-- Overlay -->
    <div class="overlay" id="overlay" onclick="closeMenus()"></div>

    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <div class="back-button" onclick="toggleMenu()">‚â™</div>
            <div class="title">Assistant</div>
        </div>
        
        <div class="header-right">
            <div class="profile-dropdown">
                <div class="profile-button" onclick="toggleProfileDropdown()">
                    üë§
                </div>
                <div class="dropdown-menu" id="profileDropdown">
                    <div class="dropdown-item" onclick="showProfile()">
                        <span>üë§</span>
                        <span>Profile</span>
                    </div>
                    <div class="dropdown-item" onclick="showNotifications()">
                        <span>üîî</span>
                        <span>Notifications</span>
                    </div>
                    <div class="dropdown-item" onclick="showSettings()">
                        <span>‚öôÔ∏è</span>
                        <span>Settings</span>
                    </div>
                    <div class="dropdown-item" onclick="logout()">
                        <span>üö™</span>
                        <span>Logout</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="voice-container">
            <!-- Smooth Waveform Visualization -->
            <div class="waveform-container">
                <svg class="waveform-svg" id="waveformSvg" viewBox="0 0 800 300">
                    <defs>
                        <!-- Gradient for the waveform -->
                        <linearGradient id="waveGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#ff6b35;stop-opacity:1" />
                            <stop offset="50%" style="stop-color:#ff8f50;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#ff6b35;stop-opacity:1" />
                        </linearGradient>
                        
                        <!-- Gradient for the fill -->
                        <linearGradient id="waveGradientFill" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#ff6b35;stop-opacity:0.6" />
                            <stop offset="100%" style="stop-color:#ff6b35;stop-opacity:0.1" />
                        </linearGradient>
                        
                        <!-- Glow effect -->
                        <filter id="glow">
                            <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                            <feMerge> 
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                    </defs>
                    
                    <!-- Waveform path will be generated by JavaScript -->
                    <path id="waveformPath" class="waveform-path" d="M 0 150 Q 200 150 400 150 Q 600 150 800 150"></path>
                    <path id="waveformFill" class="waveform-fill" d="M 0 150 Q 200 150 400 150 Q 600 150 800 150 L 800 300 L 0 300 Z"></path>
                </svg>
            </div>

            <!-- Control Buttons -->
            <div class="controls">
                <div class="secondary-button" onclick="playLastRecording()" title="Play Last">
                    ‚ñ∂Ô∏è
                </div>
                
                <div class="voice-button" id="voiceButton" onclick="toggleRecording()">
                    üé§
                </div>
                
                <div class="secondary-button" onclick="clearTranscription()" title="Clear">
                    üóëÔ∏è
                </div>
            </div>

            <!-- Status Text -->
            <div class="status-text" id="statusText">
                Tap the microphone to start speaking
            </div>
        </div>

        <!-- Response Area -->
        <div class="response-area" id="responseArea">
            <div class="response-title">Response</div>
            <div class="response-content" id="responseContent">
                Your assistant response will appear here...
            </div>
        </div>
    </div>
</div>

<script>
    // Global State
    let isRecording = false;
    let isListening = false;
    let mediaRecorder = null;
    let audioStream = null;
    let audioChunks = [];
    let waveformAnimationId = null;
    const N8N_WEBHOOK = 'https://swany.app.n8n.cloud/webhook-test/voice-command';
    // Waveform animation variables
    let waveformPoints = [];
    let animationTime = 0;
    const numPoints = 50;

    // Initialize Application
    document.addEventListener('DOMContentLoaded', function() {
        initializeWaveform();
        checkAuthStatus();
        startWaveformAnimation();
    });

    // Initialize Smooth Waveform
    function initializeWaveform() {
        // Initialize waveform points
        for (let i = 0; i < numPoints; i++) {
            waveformPoints.push({
                x: (i / (numPoints - 1)) * 800,
                y: 150 + Math.sin(i * 0.3) * 10,
                amplitude: 10,
                frequency: 0.3 + Math.random() * 0.2
            });
        }
    }

    // Smooth Waveform Animation
    function startWaveformAnimation() {
        function animate() {
            animationTime += 0.03;
            
            // Update waveform points
            waveformPoints.forEach((point, index) => {
                const baseAmplitude = isRecording ? 30 + Math.random() * 40 : 10;
                const wave = Math.sin(animationTime * 2 + index * point.frequency) * baseAmplitude;
                point.y = 150 + wave;
            });

            // Create smooth path
            const pathData = createSmoothPath(waveformPoints);
            const fillData = createSmoothPath(waveformPoints) + ' L 800 300 L 0 300 Z';
            
            document.getElementById('waveformPath').setAttribute('d', pathData);
            document.getElementById('waveformFill').setAttribute('d', fillData);
            
            waveformAnimationId = requestAnimationFrame(animate);
        }
        animate();
    }

    // Create smooth path using quadratic curves
    function createSmoothPath(points) {
        if (points.length < 2) return '';
        
        let path = `M ${points[0].x} ${points[0].y}`;
        
        for (let i = 1; i < points.length - 1; i++) {
            const currentPoint = points[i];
            const nextPoint = points[i + 1];
            const controlX = (currentPoint.x + nextPoint.x) / 2;
            
            path += ` Q ${currentPoint.x} ${currentPoint.y} ${controlX} ${(currentPoint.y + nextPoint.y) / 2}`;
        }
        
        const lastPoint = points[points.length - 1];
        path += ` Q ${lastPoint.x} ${lastPoint.y} ${lastPoint.x} ${lastPoint.y}`;
        
        return path;
    }

    // Toggle Recording
    async function toggleRecording() {
        if (!isRecording) {
            await startRecording();
        } else {
            await stopRecording();
        }
    }

    // Start Recording
   async function startRecording() {
         try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRecorder = new MediaRecorder(stream);
                audioChunks   = [];

            // Create MediaRecorder
            mediaRecorder = new MediaRecorder(audioStream, {
                mimeType: 'audio/webm;codecs=opus'
            });

            // Setup event handlers
            mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
            mediaRecorder.onstop          = () => processRecording();
            mediaRecorder.start();

            mediaRecorder.onstop = () => {
                processRecording();
            };

            // Start recording
            mediaRecorder.start();
            isRecording = true;

            // Update UI
            updateRecordingUI(true);

            console.log('Recording started...');

         } catch (err) {
    console.error('Mic access error:', err);
  }
}

    // Stop Recording
    async function stopRecording() {
  if (mediaRecorder && mediaRecorder.state !== 'inactive') {
    mediaRecorder.stop();
  }
}

    // Process Recording
    async function processRecording() {
  const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });

  const formData = new FormData();
  formData.append('audio', audioBlob, 'recording.webm');   // <‚Äî field name = audio

  try {
    const res = await fetch(N8N_WEBHOOK, {
      method: 'POST',
      body: formData       // DO NOT add headers; browser sets multipart boundary
    });

    if (!res.ok) {
      throw new Error(`HTTP ${res.status}`);
    }

    const result = await res.json();   // { transcription: "...", intent: ... }
    displayResponse(result);           // your existing UI function

  } catch (err) {
    console.error('Webhook call failed:', err);
    displayResponse({
      transcription: '',
      intent: { action: 'error', confidence: 0 },
      error: err.message
    });
  }
}

    // Update Recording UI
    function updateRecordingUI(recording) {
        const voiceButton = document.getElementById('voiceButton');
        const statusText = document.getElementById('statusText');

        if (recording) {
            voiceButton.classList.add('recording');
            voiceButton.innerHTML = '‚èπÔ∏è';
            statusText.classList.add('listening');
            statusText.innerHTML = 'Listening... <span class="loading"></span>';
        } else {
            voiceButton.classList.remove('recording');
            voiceButton.innerHTML = 'üé§';
            statusText.classList.remove('listening');
        }
    }

    // Update Status Text
    function updateStatus(message) {
        const statusText = document.getElementById('statusText');
        statusText.textContent = message;
    }

    // Display Response
    function displayResponse(result) {
        const responseArea = document.getElementById('responseArea');
        const responseContent = document.getElementById('responseContent');
        
        const content = `
            <div style="margin-bottom: 1rem;">
                <strong>You said:</strong> "${result.transcription || 'Could not transcribe audio'}"
            </div>
            <div style="margin-bottom: 1rem;">
                <strong>Intent:</strong> ${result.intent?.action || 'Unknown'} 
                <span style="color: #666;">(${Math.round((result.intent?.confidence || 0) * 100)}% confidence)</span>
            </div>
            <div>
                <strong>Action taken:</strong> ${getActionDescription(result.intent)}
            </div>
        `;
        
        responseContent.innerHTML = content;
        responseArea.classList.add('visible');

        // Hide after 10 seconds
        setTimeout(() => {
            responseArea.classList.remove('visible');
        }, 10000);
    }

    // Get Action Description
    function getActionDescription(intent) {
        if (!intent) return 'No action taken';
        
        const descriptions = {
            'create_task': 'Created a new task',
            'send_email': 'Drafted an email',
            'schedule_meeting': 'Added calendar event',
            'add_contact': 'Added new contact',
            'set_reminder': 'Created reminder',
            'get_weather': 'Retrieved weather information',
            'list_tasks': 'Listed your tasks',
            'unknown': 'Command not recognized'
        };
        
        return descriptions[intent.action] || `Executed: ${intent.action}`;
    }

    // Navigation Functions
    function toggleMenu() {
        const navMenu = document.getElementById('navMenu');
        const overlay = document.getElementById('overlay');
        
        const isOpen = navMenu.classList.contains('open');
        
        if (isOpen) {
            navMenu.classList.remove('open');
            overlay.classList.remove('visible');
        } else {
            navMenu.classList.add('open');
            overlay.classList.add('visible');
        }
        
        // Close profile dropdown if open
        closeProfileDropdown();
    }

    // Profile Dropdown Functions
    function toggleProfileDropdown() {
        const dropdown = document.getElementById('profileDropdown');
        const overlay = document.getElementById('overlay');
        
        const isVisible = dropdown.classList.contains('visible');
        
        if (isVisible) {
            dropdown.classList.remove('visible');
            overlay.classList.remove('visible');
        } else {
            dropdown.classList.add('visible');
            overlay.classList.add('visible');
        }
        
        // Close navigation menu if open
        closeMenu();
    }

    function closeProfileDropdown() {
        const dropdown = document.getElementById('profileDropdown');
        dropdown.classList.remove('visible');
    }

    function closeMenu() {
        const navMenu = document.getElementById('navMenu');
        navMenu.classList.remove('open');
    }

    function closeMenus() {
        closeMenu();
        closeProfileDropdown();
        document.getElementById('overlay').classList.remove('visible');
    }

    // Navigation Menu Functions
    function showVoiceInterface() {
        toggleMenu();
    }

    function showDashboard() {
        updateStatus('Dashboard feature coming soon...');
        toggleMenu();
    }

    function showTasks() {
        updateStatus('Tasks management coming soon...');
        toggleMenu();
    }

    function showContacts() {
        updateStatus('Contacts feature coming soon...');
        toggleMenu();
    }

    function showCalendar() {
        updateStatus('Calendar integration coming soon...');
        toggleMenu();
    }

    function showEmail() {
        updateStatus('Email drafting coming soon...');
        toggleMenu();
    }

    function showPhotos() {
        updateStatus('Photo management coming soon...');
        toggleMenu();
    }

    function showSettings() {
        updateStatus('Settings coming soon...');
        closeMenus();
    }

    // Profile Functions
    function showProfile() {
        updateStatus('Profile management coming soon...');
        closeMenus();
    }

    function showNotifications() {
        updateStatus('No new notifications');
        closeMenus();
    }

    function logout() {
        updateStatus('Logging out...');
        localStorage.removeItem('authToken');
        closeMenus();
        // Add logout logic here
    }

    // Utility Functions
    function playLastRecording() {
        updateStatus('Last recording playback coming soon...');
    }

    function clearTranscription() {
        const responseArea = document.getElementById('responseArea');
        responseArea.classList.remove('visible');
        updateStatus('Tap the microphone to start speaking');
    }

    // Auth Functions
    function checkAuthStatus() {
        if (!authToken) {
            authToken = 'demo-token';
            localStorage.setItem('authToken', authToken);
            updateStatus('Demo mode - connect to your backend for full functionality');
        }
    }

    // Keyboard Shortcuts
    document.addEventListener('keydown', function(event) {
        // Space bar to toggle recording
        if (event.code === 'Space' && !event.target.matches('input, textarea')) {
            event.preventDefault();
            toggleRecording();
        }
        
        // Escape to close menus
        if (event.code === 'Escape') {
            closeMenus();
        }
    });

    // Click outside to close dropdowns
    document.addEventListener('click', function(event) {
        const profileDropdown = document.getElementById('profileDropdown');
        const profileButton = event.target.closest('.profile-button');
        
        if (!profileButton && !event.target.closest('.dropdown-menu')) {
            closeProfileDropdown();
        }
    });

    // Error Handling
    window.addEventListener('error', function(event) {
        console.error('Application error:', event.error);
        updateStatus('An error occurred. Please refresh the page.');
    });

    // Prevent zoom on double tap (mobile)
    let lastTouchEnd = 0;
    document.addEventListener('touchend', function (event) {
        const now = (new Date()).getTime();
        if (now - lastTouchEnd <= 300) {
            event.preventDefault();
        }
        lastTouchEnd = now;
    }, false);
</script>
</body>
</html></parameter>
</invoke>
</artifacts>